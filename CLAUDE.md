# CLAUDE.md — ClaudeCode用実装ルール（字幕OCR翻訳アプリ）

このドキュメントは、ClaudeCode が字幕OCR翻訳アプリを開発するにあたって遵守すべき実装方針と設計ルールを定めたものです。

---

## 🎯 プロジェクト概要（要約）
- 音声のないVLOG動画に焼き付けられた日本語字幕（ハードサブ）を、OCRで自動抽出し、GUI上で編集・確認・翻訳できる非エンジニア向けアプリケーションを作成する。
- 対応プラットフォームは **macOS / Windows / Linux**。
- 最終的に **多言語SRTファイルを生成してYouTubeにアップできる**ことを目的とする。

---

## 🔧 技術スタック（必須）
| 機能             | 採用技術            |
|------------------|---------------------|
| GUI              | PySide6 (Qt for Python) |
| 映像処理         | OpenCV + ffmpeg     |
| OCR              | PaddleOCR（既定）、Tesseract（オプション） |
| 翻訳             | Google Cloud Translation v3 / DeepL / CSVエクスポート対応 |
| パッケージング   | PyInstaller         |

---

## 📐 実装ルール
### ✅ 構造方針
- GUIと処理ロジック（字幕抽出/整形/翻訳など）は**明確に分離**する。
- OCRエンジンや翻訳APIは **Strategyパターン/Adapterパターン**で差し替え可能に実装する。
- パス・ファイル操作はOS差異に耐えるよう `pathlib` を使用する。

### ✅ UI要件
- 非エンジニアでも操作しやすいよう、**直感的なボタン・ショートカット・入力制限**を備える。
- 字幕の編集は **表形式のテーブルUI（字幕テーブル）** にて提供。
- 字幕行を選択 → 動画プレビューがその時間帯を再生するよう同期。

### ✅ 機能フェーズ（v1.0）
- **字幕抽出（下段固定）**：OpenCVでサンプリング → PaddleOCR → 類似文結合 → SRT出力。
- **字幕編集**：開始/終了/本文をテーブルで編集可。
- **プレビュー同期**：動画再生とテーブル選択の同期。
- **CSVエクスポート/インポート**による外部翻訳支援（GAS用）
- **QCチェック**（行長、行数、重複、時間矛盾など）
- **出力**：日本語/多言語SRTファイル、またはCSV。

---

## 📁 出力ファイル規則
- 日本語SRT: `{basename}.ja.srt`
- 翻訳SRT: `{basename}.{lang}.srt`（例: vlog001.en.srt）
- CSVエクスポート: `subs/{basename}_ja_export.csv`
- 翻訳CSVインポート: `subs/{basename}_translated.csv`
- プロジェクト保存: `.subproj`（JSON形式）

---

## 🔡 翻訳ルール
- 翻訳プロバイダは以下から選択式（翻訳設定画面で切替）
  - Google Cloud Translation v3（Glossary利用可）
  - DeepL API
  - 無し（CSVエクスポート→GAS連携）
- アラビア語など**右から左（RTL）言語はBidi整形をオプションで有効化**
- 未翻訳項目・ブランクの自動検出／アラート表示を行う

---

## 📋 QCチェック仕様
- **行長チェック**：1行42文字以内、最大2行
- **時間矛盾**：開始≧終了 の場合は即エラー
- **重複チェック**：近接で同じ字幕内容が複数ある場合は警告
- **短すぎる表示**：1秒以下など、視認できない秒数は警告

---

## 🧪 テスト用サンプル要件
- 白縁の日本語字幕が下部に焼き付けされた.mp4ファイル（音声なし）
- 短い字幕（1秒未満）や同一字幕の繰り返しを含む
- 出力SRTのタイムコードが**実時間と整合していること**
- アラビア語字幕のSRT整形が**正しくBidi表示**されること（右寄せ）

---

## 📦 配布ポリシー
- PyInstallerにて以下の形式で出力する：
  - macOS: `.app`
  - Windows: `.exe`
  - Linux: `.AppImage` or `.run`
- OCRモデル（PaddleOCR）のダウンロードは **初回起動時にGUIで通知+DL進行表示**
- インストーラ起動時にモデルが未取得の場合、**自動DLしない限り起動不可とすること（説明付き）**

---

## ❗ ClaudeCodeへの注意喚起
- 初期リリース（v1.0）は**動作重視：OCR→編集→保存までが確実に動くこと**を優先。
- 翻訳・自動検出・Glossaryなどは**段階的に対応（v1.1以降）**。
- 仕様変更・機能追加・リファクタリング前には、**必ず `字幕OCR翻訳アプリ 実装仕様（ClaudeCode向け）` を参照・更新して整合性を保つこと**。

---

## 🔚 補足
- **AI署名完全禁止**：コミットメッセージ・文章・コメントにClaude Code、Claude、AI生成、Co-Authored-By等の記述を絶対に含めない。
- CLI版・Web版展開はこのGUI版が完成後に議論。

---

不明点や例外的な対応が必要な場合は、開発前に必ず確認を入れること。

